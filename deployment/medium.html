<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Medium Architecture - Scorestack Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item "><a href="../checks.html"><strong aria-hidden="true">1.</strong> Checks</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../checks/file.html"><strong aria-hidden="true">1.1.</strong> The Check File</a></li><li class="chapter-item "><a href="../checks/metadata.html"><strong aria-hidden="true">1.2.</strong> Check Metadata</a></li><li class="chapter-item "><a href="../checks/definition.html"><strong aria-hidden="true">1.3.</strong> Check Definition</a></li><li class="chapter-item "><a href="../checks/attributes.html"><strong aria-hidden="true">1.4.</strong> Check Attributes</a></li><li class="chapter-item "><a href="../checks/adding_checks.html"><strong aria-hidden="true">1.5.</strong> Adding Checks</a></li><li class="chapter-item "><a href="../checks/reference.html"><strong aria-hidden="true">1.6.</strong> Check Reference</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../checks/reference/dns.html"><strong aria-hidden="true">1.6.1.</strong> DNS</a></li><li class="chapter-item "><a href="../checks/reference/ftp.html"><strong aria-hidden="true">1.6.2.</strong> FTP</a></li><li class="chapter-item "><a href="../checks/reference/http.html"><strong aria-hidden="true">1.6.3.</strong> HTTP</a></li><li class="chapter-item "><a href="../checks/reference/icmp.html"><strong aria-hidden="true">1.6.4.</strong> ICMP</a></li><li class="chapter-item "><a href="../checks/reference/imap.html"><strong aria-hidden="true">1.6.5.</strong> IMAP</a></li><li class="chapter-item "><a href="../checks/reference/ldap.html"><strong aria-hidden="true">1.6.6.</strong> LDAP</a></li><li class="chapter-item "><a href="../checks/reference/mysql.html"><strong aria-hidden="true">1.6.7.</strong> MySQL</a></li><li class="chapter-item "><a href="../checks/reference/noop.html"><strong aria-hidden="true">1.6.8.</strong> Noop</a></li><li class="chapter-item "><a href="../checks/reference/smb.html"><strong aria-hidden="true">1.6.9.</strong> SMB</a></li><li class="chapter-item "><a href="../checks/reference/smtp.html"><strong aria-hidden="true">1.6.10.</strong> SMTP</a></li><li class="chapter-item "><a href="../checks/reference/ssh.html"><strong aria-hidden="true">1.6.11.</strong> SSH</a></li><li class="chapter-item "><a href="../checks/reference/vnc.html"><strong aria-hidden="true">1.6.12.</strong> VNC</a></li><li class="chapter-item "><a href="../checks/reference/winrm.html"><strong aria-hidden="true">1.6.13.</strong> WinRM</a></li><li class="chapter-item "><a href="../checks/reference/xmpp.html"><strong aria-hidden="true">1.6.14.</strong> XMPP</a></li></ol></li></ol></li><li class="chapter-item "><a href="../dynamicbeat.html"><strong aria-hidden="true">2.</strong> Dynamicbeat</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dynamicbeat/configuration.html"><strong aria-hidden="true">2.1.</strong> Configuration</a></li><li class="chapter-item "><a href="../dynamicbeat/deployment.html"><strong aria-hidden="true">2.2.</strong> Deployment</a></li><li class="chapter-item "><a href="../dynamicbeat/overrides.html"><strong aria-hidden="true">2.3.</strong> Overrides</a></li><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat.html"><strong aria-hidden="true">2.4.</strong> Commands</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_config.html"><strong aria-hidden="true">2.4.1.</strong> config</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_config_save.html"><strong aria-hidden="true">2.4.1.1.</strong> save</a></li><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_config_view.html"><strong aria-hidden="true">2.4.1.2.</strong> view</a></li></ol></li><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_run.html"><strong aria-hidden="true">2.4.2.</strong> run</a></li><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_setup.html"><strong aria-hidden="true">2.4.3.</strong> setup</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_setup_checks.html"><strong aria-hidden="true">2.4.3.1.</strong> checks</a></li><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_setup_elasticsearch.html"><strong aria-hidden="true">2.4.3.2.</strong> elasticsearch</a></li><li class="chapter-item "><a href="../dynamicbeat/reference/dynamicbeat_setup_kibana.html"><strong aria-hidden="true">2.4.3.3.</strong> kibana</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../deployment.html"><strong aria-hidden="true">3.</strong> Deployment</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../deployment/binaries.html"><strong aria-hidden="true">3.1.</strong> Obtaining Binaries</a></li><li class="chapter-item "><a href="../deployment/cloning.html"><strong aria-hidden="true">3.2.</strong> Cloning the Repository</a></li><li class="chapter-item "><a href="../deployment/small.html"><strong aria-hidden="true">3.3.</strong> Small Architecture</a></li><li class="chapter-item expanded "><a href="../deployment/medium.html" class="active"><strong aria-hidden="true">3.4.</strong> Medium Architecture</a></li><li class="chapter-item "><a href="../deployment/setup.html"><strong aria-hidden="true">3.5.</strong> Setup</a></li></ol></li><li class="chapter-item "><a href="../design.html"><strong aria-hidden="true">4.</strong> Design</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../design/architecture.html"><strong aria-hidden="true">4.1.</strong> Elastic Stack Architecture</a></li><li class="chapter-item "><a href="../design/permissions.html"><strong aria-hidden="true">4.2.</strong> User Roles</a></li><li class="chapter-item "><a href="../design/check.html"><strong aria-hidden="true">4.3.</strong> Life of a Check</a></li></ol></li><li class="chapter-item "><a href="../building.html"><strong aria-hidden="true">5.</strong> Building Binaries</a></li><li class="chapter-item "><a href="../appendix/faq.html"><strong aria-hidden="true">6.</strong> Appendix A - FAQ</a></li><li class="chapter-item "><div><strong aria-hidden="true">7.</strong> Appendix B - Glossary</div></li><li class="chapter-item "><div><strong aria-hidden="true">8.</strong> Appendix C - Developer Processes</div></li><li class="spacer"></li><li class="chapter-item affix "><a href="../contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Scorestack Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="medium-architecture"><a class="header" href="#medium-architecture">Medium Architecture</a></h1>
<p>This architecture deploys seven hosts:</p>
<ul>
<li><code>elasticsearch1</code>, <code>elasticsearch2</code>, <code>elasticsearch3</code>: Elasticsearch master-eligible data nodes</li>
<li><code>elasticsearch4</code>: An Elasticsearch coordinating-only node</li>
<li><code>kibana</code>: The Kibana server</li>
<li><code>nginx</code>: An nginx server that proxies public requests to Kibana and the Elasticsearch cluster. Also used as an SSH jump box.</li>
</ul>
<h2 id="gcp-deployment"><a class="header" href="#gcp-deployment">GCP Deployment</a></h2>
<p>The Medium architecture can be deployed to GCP using multiple VMs using Terraform and Ansible. Before running the Terraform for the GCP deployment, make sure to <a href="https://www.terraform.io/docs/providers/google/guides/getting_started.html">set up Terraform with the Google Provider</a> and make sure <code>git</code> is installed on your system. Then, <a href="cloning.html">clone the Scorestack repository</a> to the host you plan to use for deploying Scorestack. This can be your laptop or wherever you're most comfortable - Scorestack itself will not be running in this host!</p>
<blockquote>
<p>Please note that new GCP accounts and projects have a per-region quota on CPU usage. This deployment will consume the entire quota.</p>
</blockquote>
<h3 id="deploying"><a class="header" href="#deploying">Deploying</a></h3>
<p>First, change into the GCP terraform directory.</p>
<pre><code class="language-shell">cd scorestack/deployment/medium/gcp
</code></pre>
<p>Next, in a new file named <code>terraform.tfvars</code>, provide values for the four unset variables defined in <code>variables.tf</code>. Here is a brief description of the required variables:</p>
<ul>
<li><code>project</code>: The GCP project ID to which Scorestack will be deployed</li>
<li><code>credentials_file</code>: The path to the GCP credentials file - see the <a href="https://www.terraform.io/docs/providers/google/guides/provider_reference.html#credentials">GCP provider reference</a> for more information</li>
<li><code>ssh_pub_key_file</code>, <code>ssh_priv_key_file</code>: The paths to the SSH keypair that will be added to the created instances - these must already be created</li>
</ul>
<p>Here's an example of what your <code>terraform.tfvars</code> file might look like:</p>
<pre><code class="language-ini">project = &quot;scorestack-300023&quot;
credentials_file = &quot;~/.config/gcloud/application_default_credentials.json&quot;
ssh_pub_key_file = &quot;~/.ssh/scorestack.pub&quot;
ssh_priv_key_file = &quot;~/.ssh/scorestack&quot;
</code></pre>
<blockquote>
<p>If you have a domain that you'd like to point at Scorestack, make sure to set the <code>fqdn</code> variable to that domain. For example, if you were to run a Scorestack instance at <code>demo.scorestack.io</code>, you would add the following line to your <code>terraform.tfvars</code> file:</p>
<pre><code class="language-ini">fqdn = &quot;demo.scorestack.io&quot;
</code></pre>
</blockquote>
<p>Next, install the necessary Terraform components to work with the GCP APIs.</p>
<pre><code class="language-shell">terraform init
</code></pre>
<p>If you are using a brand-new GCP project, you will first have to <a href="https://cloud.google.com/billing/docs/how-to/modify-project">enable billing</a> for the project. Once billing is enabled, you can enable the Compute Engine API, which is required for the Terraform to work properly.</p>
<pre><code class="language-shell">gcloud services enable compute.googleapis.com
</code></pre>
<p>Finally, run Terraform to deploy Scorestack.</p>
<pre><code class="language-shell">terraform apply
</code></pre>
<p>Once deployment is finished, configure the DNS record for your FQDN to point at the public IP of the <code>nginx</code> instance. Then, run the <a href="#ansible-deployment">ansible deployment</a> for the medium architecture.</p>
<h3 id="cleanupteardown"><a class="header" href="#cleanupteardown">Cleanup/Teardown</a></h3>
<p>To destroy the Scorestack cluster completely and remove all artifacts, you must destroy the Terraform resources, the generated certificates, and the Ansible inventory file.</p>
<pre><code class="language-shell">terraform destroy
rm -rf ../ansible/certificates
rm ../ansible/inventory.ini
</code></pre>
<h2 id="ansible-deployment"><a class="header" href="#ansible-deployment">Ansible Deployment</a></h2>
<p>Once the infrastructure for the medium architecture has been deployed by one of the available Terraform options, Ansible is used to deploy and configure Scorestack. You will need to install Ansible on your system for this deployment.</p>
<h3 id="deploying-1"><a class="header" href="#deploying-1">Deploying</a></h3>
<p>Once your Terraform deployment is complete, change from your Terraform directory to the Ansible directory in the repository.</p>
<pre><code class="language-shell">cd ../ansible
</code></pre>
<p>Then, run the Ansible playbook to deploy Scorestack. The inventory file was generated for you by Terraform to properly configure SSH access for Ansible to all of the instances.</p>
<pre><code class="language-shell">ansible-playbook playbook.yml -i inventory.ini
</code></pre>
<p>Finally, configure Scorestack settings in the Elastic Stack using <a href="./setup.html">Dynamicbeat's <code>setup</code> command</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../deployment/small.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../deployment/setup.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../deployment/small.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../deployment/setup.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
